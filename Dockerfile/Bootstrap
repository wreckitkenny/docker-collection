FROM registry.vnpay.vn/tools/base:1.0.0

RUN set -eux; \
    apt-get update; \
    apt-get install -y \
        python3 \
        python3-pip \
        python3-wheel \
        python-is-python3 \
        python3-setuptools; \
    \
    ln -s -f  /usr/bin/pip3 /usr/bin/pip; \
    pip config set --global global.no-cache-dir True; \
    pip completion --bash > /etc/bash_completion.d/pip; \
    \
    apt-get clean; \
    rm -rf /var/lib/apt/lists/*

RUN set -eux; \
    curl -sSL "https://dl.min.io/client/mc/release/linux-amd64/mc" \
          -o /usr/local/bin/mc; \
    chmod +x /usr/local/bin/mc; \
    mc --autocompletion;

ARG ANSIBLE_VERSION=9.0.0

RUN pip install ansible \
        Jinja2  \
        toml    \
        PyYAML  \
        paramiko \
        argcomplete \
        apache-libcloud; \
    activate-global-python-argcomplete;

RUN set -eux; \
    curl -sSL "https://dl.min.io/client/mc/release/linux-amd64/mc" \
          -o /usr/local/bin/mc; \
    chmod +x /usr/local/bin/mc; \
    mc --autocompletion;

# default command: display Ansible version
CMD [ "ansible-playbook", "--version" ]
